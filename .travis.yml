language: node_js

sudo: false

node_js:
  - 14
  - 12
  - 10

os:
  - linux
  - osx
  - windows

install:
  - npm run setup

script:
  - npm run test:ci

stages:
  - audit
  - lint
  - test
  - name: deploy
    if: tag=~^v AND repo=brianneisler/firetree

jobs:
  include:
    - stage: audit
      node_js: 14
      os: linux
      script: npm run security:audit
    - stage: lint
      node_js: 14
      os: linux
      script: npm run lint
    - stage: deploy
      node_js: 14
      os: linux
      script: echo "Deploying to npm ..."
      deploy:
        provider: npm
        skip_cleanup: true
        email: me@brianneisler.com
        api_key: '$NPM_TOKEN'
        on:
          tags: true
env:
  global:
    secure: VZE41qiIaPm7KExK1DPoeWIiyP/IqeeMSISaR5ZnC6MTXIpU9EsLYFrn30uGo2OlPrKpw4jW717lyLEUDLJye4Cky5zzrgTzDEJaW1Y2ROoIZhG/P8NGXWS1qsCcVx4wop7IsxN1aeNIHR9szLIPkrN2DGOUm6y82lfZG27aLHyCtt8SqUZUek/c0aVf3kAzI2Q4FkQd4s7EDJW2YPBlTeX6otvnPAeeWshJyVUPn0vn1c9LAvClLRLV/bOhe2eoAQMzVjMerDsvBN58Gmrw8g3qXyU8yRPr6OyOopREHajbw5B3jYwmQ/c/Q7JpEF6ZcKM6NGK4M8hLlRViaH82PhItzUZ+74a5FT4HOHzF9gb8xM/eYJsFbF0PjhvE8AR1rkwHBpE/Bw96uOXLOJ8Qstbjn1H9VqdQwQWLg8qtzPobIx5eqXJiTGbdMyQI7Gw0nDS4TNwsrY3UOYdFLRL0izXOZgx3Pp6L4I7W2PLPOxJZb0mak/pGY2TFetsrR8m9LzDmGJQr1i2EsKpBdwNOgeFD0I85dxgELu5jvGmy9+Gul/zuK1JByYLTmcONyoYTKTgIKJlJcXojuC6UQLN9ShboQ/qmphBiBOJlEVjkWBghV3aY5pUJ54lwB8Z+icrfQ7oa5CPc3/eSGqanMkiI+yZYJRqYq1hR1BQD5DG56LE=
